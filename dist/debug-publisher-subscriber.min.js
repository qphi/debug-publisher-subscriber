!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.TimelinePubSub=n():t.TimelinePubSub=n()}(this,(()=>(()=>{var t={605:function(t){t.exports=function(){"use strict";var t={412:function(t,n,e){function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(n,"t",{value:!0});var r=e(775),o=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,e,o;return n=t,e=[{key:"set",value:function(t,n,e){for(var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",u=t.split(o),c=e,s=e,f=0;f<u.length;f++){var a=u[f];if(0===a.length)throw new r.default('"'.concat(t,'" is not a valid property path.'));void 0===c[a]&&(c[a]={}),s=c,c=c[a],i=a}return s[i]=n,e}},{key:"get",value:function(t,n){for(var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".",i=t.split(e),o=n,u=0;u<i.length;u++){var c=i[u];if(0===c.length)throw new r.default('"'.concat(t,'" is not a valid property path.'));if(void 0===o[c])return null;o=o[c]}return o}}],e&&i(n.prototype,e),o&&i(n,o),t}();n.default=o},775:function(t,n){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function r(t){var n="function"==typeof Map?new Map:void 0;return r=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,i)}function i(){return o(t,arguments,s(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),c(i,t)},r(t)}function o(t,n,e){return o=u()?Reflect.construct:function(t,n,e){var i=[null];i.push.apply(i,n);var r=new(Function.bind.apply(t,i));return e&&c(r,e.prototype),r},o.apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function c(t,n){return c=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},c(t,n)}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}Object.defineProperty(n,"t",{value:!0});var f=function(t){!function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&c(t,n)}(o,t);var n,e,r=(n=o,e=u(),function(){var t,r=s(n);if(e){var o=s(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return i(this,t)});function o(t){var n;return function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),(n=r.call(this,t)).name="InvalidParameterException",n}return o}(r(Error));n.default=f},524:function(t,n,e){function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&b(t,n)}function u(t){var n=l();return function(){var e,i=h(t);if(n){var r=h(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return c(this,e)}}function c(t,n){if(n&&("object"===i(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return s(t)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){var n="function"==typeof Map?new Map:void 0;return f=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,i)}function i(){return a(t,arguments,h(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),b(i,t)},f(t)}function a(t,n,e){return a=l()?Reflect.construct:function(t,n,e){var i=[null];i.push.apply(i,n);var r=new(Function.bind.apply(t,i));return e&&b(r,e.prototype),r},a.apply(null,arguments)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function b(t,n){return b=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},b(t,n)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}Object.defineProperty(n,"t",{value:!0}),n.SubscriptionNotFoundException=n.SubscriptionAlreadyExistsException=n.InvalidArgumentException=n.DomainException=void 0;var v=function(t){o(e,t);var n=u(e);function e(){return r(this,e),n.apply(this,arguments)}return e}(f(Error));n.DomainException=v;var y=e(552),d=function(t){o(e,t);var n=u(e);function e(t){var i;return r(this,e),(i=n.call(this,t)).name=i.constructor.name,(0,y.captureStackTrace)(s(i),i.constructor),i}return e}(v);n.InvalidArgumentException=d;var p=function(t){o(e,t);var n=u(e);function e(t,i){var o;return r(this,e),(o=n.call(this,'Unable to add subscription "'.concat(t,'" to component "').concat(i,'" because it already manage a subscription with same id.'))).name=o.constructor.name,(0,y.captureStackTrace)(s(o),o.constructor),o}return e}(v);n.SubscriptionAlreadyExistsException=p;var w=function(t){o(e,t);var n=u(e);function e(t,i){var o;return r(this,e),(o=n.call(this,'Unable to find subscription with id "'.concat(t,'" in component "').concat(i,'".'))).name=o.constructor.name,(0,y.captureStackTrace)(s(o),o.constructor),o}return e}(v);n.SubscriptionNotFoundException=w},413:function(t,n){Object.defineProperty(n,"t",{value:!0}),n.generateId=void 0;var e=new Map;n.generateId=function(t){var n,i=null!==(n=e.get(t))&&void 0!==n?n:0;return e.set(t,i+1),"".concat(t,"_").concat(i)}},552:function(t,n){Object.defineProperty(n,"t",{value:!0}),n.captureStackTrace=void 0,n.captureStackTrace=function(t,n){"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(t,n)}},322:function(t,n,e){Object.defineProperty(n,"t",{value:!0}),n.subscribeFromObject=void 0;var i=new(e(412).default);n.subscribeFromObject=function(t,n,e){Object.values(e).forEach((function(e){var r=t[e.action];if("function"==typeof r){var o=r.bind(t);t.subscribe(n,e.notification,(function(t){var n={};if(void 0!==e.mapAttributes){var r=e.mapAttributes;Object.keys(r).forEach((function(e){var o,u=null!==(o=r[e])&&void 0!==o?o:"";n[e]=i.get(u,t)})),o(n)}else o(t)}))}}))}},537:function(t,n,e){Object.defineProperty(n,"t",{value:!0}),n.HIGH_PRIORITY=n.DEFAULT_PRIORITY=n.LOW_PRIORITY=n.ROLE=n.findSubscriptionByRoleAndComponentId=void 0;var i=e(524);n.findSubscriptionByRoleAndComponentId=function(t,e,r){if(e!==n.ROLE.PUBLISHER_ID&&e!==n.ROLE.SUBSCRIBER_ID)throw new i.InvalidArgumentException('Invalid argument given for "role" in "findSubscriptionByRoleAndComponentId". Values expected are "publisher_id" or "subscriber_id" but "'.concat(e,'" was given.'));return t.getSubscriptions().filter((function(t){return(e===n.ROLE.PUBLISHER_ID?t.publisher_id:t.subscriber_id)===r}))},n.ROLE={PUBLISHER_ID:"publisher_id",SUBSCRIBER_ID:"subscriber_id"},n.LOW_PRIORITY=-100,n.DEFAULT_PRIORITY=0,n.HIGH_PRIORITY=100},986:function(t,n,e){function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(n,"t",{value:!0});var r=e(829),o=e(757),u=e(537),c=e(524),s=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.proxies=new Map,this.removedSelfSubscription=new Set,this.id=n,this.publisher=new r.default(n),this.subscriber=new o.default(n)}var n,e,s;return n=t,e=[{key:"hasSubscription",value:function(t){return this.subscriber.hasSubscription(t)||this.publisher.hasSubscription(t)}},{key:"addSubscriber",value:function(t,n){this.publisher.addSubscriber(t,n)}},{key:"removeSubscriber",value:function(t){this.publisher.removeSubscriber(t)}},{key:"getNbSubscriptionsAsPublisher",value:function(){return this.publisher.getNbSubscriptions()}},{key:"getNbSubscriptionsAsSubscriber",value:function(){return this.subscriber.getNbSubscriptions()}},{key:"publish",value:function(t,n){this.publisher.publish(t,n)}},{key:"getId",value:function(){return this.id}},{key:"subscribe",value:function(t,n,e,i){return this.subscriber.subscribe.apply(this,[t,n,e,i])}},{key:"getNbSubscriptions",value:function(){return this.subscriber.getNbSubscriptions()}},{key:"removeSubscription",value:function(t){this.subscriber.removeSubscription(t)}},{key:"addSubscription",value:function(t,n){this.subscriber.addSubscription(t,n)}},{key:"waitUntil",value:function(t){return this.subscriber.waitUntil(t)}},{key:"destroy",value:function(){this.publisher.destroy(),this.subscriber.destroy()}},{key:"is",value:function(t){return this.id===t}},{key:"findSubscriptionById",value:function(t){return this.subscriber.findSubscriptionById(t)||this.publisher.findSubscriptionById(t)}},{key:"findSubscriptionsByNotificationAndPublisherId",value:function(t,n){return this.subscriber.findSubscriptionsByNotificationAndPublisherId(t,n)}},{key:"findSubscriptionsByNotification",value:function(t){return this.subscriber.findSubscriptionsByNotification(t).concat(this.publisher.findSubscriptionsByNotification(t))}},{key:"getSubscriptions",value:function(){return this.subscriber.getSubscriptions().concat(this.publisher.getSubscriptions())}},{key:"unsubscribeFromNotification",value:function(t){this.subscriber.unsubscribeFromNotification(t)}},{key:"unsubscribeFromPublisherId",value:function(t){this.subscriber.unsubscribeFromPublisherId(t)}},{key:"unsubscribeFromSubscriptionId",value:function(t){this.subscriber.unsubscribeFromSubscriptionId(t)}},{key:"continuePublicationOnException",value:function(){this.publisher.continuePublicationOnException()}},{key:"findSubscriptionByPublisherId",value:function(t){var n=this.subscriber.findSubscriptionByPublisherId(t).concat((0,u.findSubscriptionByRoleAndComponentId)(this.publisher,u.ROLE.PUBLISHER_ID,t));return t===this.getId()?Array.from(new Set(n)):n}},{key:"findSubscriptionsByNotificationAndSubscriberId",value:function(t,n){return this.publisher.findSubscriptionsByNotificationAndSubscriberId(t,n)}},{key:"findSubscriptionBySubscriberId",value:function(t){var n=this.publisher.findSubscriptionBySubscriberId(t).concat((0,u.findSubscriptionByRoleAndComponentId)(this.subscriber,u.ROLE.SUBSCRIBER_ID,t));return t===this.getId()?Array.from(new Set(n)):n}},{key:"stopPublicationOnException",value:function(){this.publisher.stopPublicationOnException()}},{key:"clearSubscription",value:function(t){if(this.removedSelfSubscription.has(t))this.removedSelfSubscription.delete(t);else{var n=this.findSubscriptionById(t);if(null===n)throw new c.SubscriptionNotFoundException(t,this.getId());(null==n?void 0:n.subscriber_id)===this.subscriber.getId()&&this.subscriber.clearSubscription(t),(null==n?void 0:n.publisher_id)===this.publisher.getId()&&this.publisher.clearSubscription(t),(null==n?void 0:n.publisher_id)===(null==n?void 0:n.subscriber_id)&&this.removedSelfSubscription.add(t)}}},{key:"addProxy",value:function(t,n){var e=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return t},r=this.getPublisherProxies(t.getId()),o=this.subscribe(t,n,(function(t){e.publish(n,i(t))}));return r.add(o.id),this.proxies.set(t.getId(),r),this}},{key:"getPublisherProxies",value:function(t){var n;return null!==(n=this.proxies.get(t))&&void 0!==n?n:new Set}},{key:"removeProxy",value:function(t,n){var e=this,i=this.findSubscriptionsByNotificationAndPublisherId(n,t.getId()),r=this.getPublisherProxies(t.getId());return i.filter((function(t){return r.has(t.id)})).forEach((function(t){e.unsubscribeFromSubscriptionId(t.id),r.delete(t.id)})),this}}],e&&i(n.prototype,e),s&&i(n,s),t}();n.default=s},829:function(t,n,e){function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function u(t,n){return u=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},u(t,n)}function c(t){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var e,i=f(t);if(n){var r=f(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return s(this,e)}}function s(t,n){if(n&&("object"===i(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}Object.defineProperty(n,"t",{value:!0});var a=e(657),l=e(537),b=function(t){!function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&u(t,n)}(f,t);var n,e,i,s=c(f);function f(){var t;return r(this,f),(t=s.apply(this,arguments)).shouldIStopPublicationOnException=!1,t}return n=f,(e=[{key:"stopPublicationOnException",value:function(){this.shouldIStopPublicationOnException=!0}},{key:"continuePublicationOnException",value:function(){this.shouldIStopPublicationOnException=!1}},{key:"publish",value:function(t,n){var e=this,i=this.notificationsCollection[t];Array.isArray(i)&&i.slice(0).forEach((function(t){try{t.handler(n)}catch(t){if(e.shouldIStopPublicationOnException)throw t}}))}},{key:"findSubscriptionBySubscriberId",value:function(t){return(0,l.findSubscriptionByRoleAndComponentId)(this,l.ROLE.SUBSCRIBER_ID,t)}},{key:"findSubscriptionsByNotificationAndSubscriberId",value:function(t,n){return this.findSubscriptionsByNotification(t).filter((function(t){return t.subscriber_id===n}))}},{key:"addSubscriber",value:function(t,n){this.addSubscription(t,n)}},{key:"removeSubscriber",value:function(t){this.findSubscriptionBySubscriberId(t).forEach((function(t){return t.unsubscribe()}))}}])&&o(n.prototype,e),i&&o(n,i),f}(a.default);n.default=b},757:function(t,n,e){function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function u(t,n){return u=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},u(t,n)}function c(t){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var e,i=f(t);if(n){var r=f(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return s(this,e)}}function s(t,n){if(n&&("object"===i(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}Object.defineProperty(n,"t",{value:!0});var a=e(657),l=e(537),b=e(524),h=e(413),v=function(t){!function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&u(t,n)}(a,t);var n,e,s,f=c(a);function a(){return r(this,a),f.apply(this,arguments)}return n=a,e=[{key:"unsubscribeFromSubscriptionId",value:function(t){var n=this.findSubscriptionById(t);if(null===n)throw new b.SubscriptionNotFoundException(t,this.getId());n.unsubscribe()}},{key:"findSubscriptionByPublisherId",value:function(t){return(0,l.findSubscriptionByRoleAndComponentId)(this,l.ROLE.PUBLISHER_ID,t)}},{key:"unsubscribeFromPublisherId",value:function(t){this.findSubscriptionByPublisherId(t).map((function(t){return t.unsubscribe})).forEach((function(t){t()}))}},{key:"unsubscribeFromNotification",value:function(t){this.findSubscriptionsByNotification(t).map((function(t){return t.unsubscribe})).forEach((function(t){t()}))}},{key:"subscribe",value:function(t,n,e){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.DEFAULT_PRIORITY,u=this.getNbSubscriptions(),c="sub_".concat(this.getId(),"_to_").concat(t.getId(),"_salt_").concat(u);if(isNaN(o)||"number"!=typeof o)throw new b.InvalidArgumentException('Unable to create a subscription with priority "'.concat(o,'" (typed as "').concat(i(o),'"). Number value is expected.'));var s={id:c,subscriber_id:this.getId(),publisher_id:t.getId(),unsubscribe:function(){t.clearSubscription(c),r.clearSubscription(c)},priority:o,handler:e};return this.addSubscription(n,s),t.addSubscriber(n,s),s}},{key:"getNbSubscriptions",value:function(){return this.nbSubscriptionRecorded}},{key:"removeSubscription",value:function(t){this.clearSubscription(t)}},{key:"waitUntil",value:function(t){var n=new a((0,h.generateId)("wait-until-".concat(t.map((function(t){return t.name})).join("-and-"),"-salt")));return new Promise((function(e){Promise.all(t.map((function(t){return new Promise((function(e){n.subscribe(t.from,t.name,(function(t){e(t)}))}))}))).then((function(t){n.destroy(),e(t)}))}))}},{key:"findSubscriptionsByNotificationAndPublisherId",value:function(t,n){return this.findSubscriptionsByNotification(t).filter((function(t){return t.publisher_id===n}))}}],e&&o(n.prototype,e),s&&o(n,s),a}(a.default);n.default=v},657:function(t,n,e){function i(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return r(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function o(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Object.defineProperty(n,"t",{value:!0});var u=e(524),c=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscriptionsList={},this.notificationsCollection={},this.nbSubscriptionRecorded=0,this.id=n}var n,e,r;return n=t,(e=[{key:"getSubscriptions",value:function(){return[].concat.apply([],Object.values(this.notificationsCollection))}},{key:"getNbSubscriptions",value:function(){return this.nbSubscriptionRecorded}},{key:"hasSubscription",value:function(t){return void 0!==this.subscriptionsList[t]}},{key:"recordSubscription",value:function(t,n){this.subscriptionsList[t]=n}},{key:"findSubscriptionIndexById",value:function(t){var n=this.subscriptionsList[t],e={index:-1,notification:null!=n?n:""};if(void 0===n)return e;var i=this.notificationsCollection[n];return Array.isArray(i)&&(e.index=i.findIndex((function(n){return n.id===t}))),e}},{key:"findSubscriptionById",value:function(t){var n=this.findSubscriptionIndexById(t);return n.index<0?null:this.notificationsCollection[n.notification][n.index]}},{key:"findSubscriptionsByNotification",value:function(t){return this.notificationsCollection[t]||[]}},{key:"clearSubscription",value:function(t){var n=this.findSubscriptionIndexById(t);if(n.index<0)throw new u.SubscriptionNotFoundException(t,this.getId());var e=this.notificationsCollection[n.notification].splice(n.index,1)[0];"function"==typeof e.handler&&delete e.handler,delete this.subscriptionsList[t],this.nbSubscriptionRecorded--,0===this.notificationsCollection[n.notification].length&&delete this.notificationsCollection[n.notification]}},{key:"addSubscription",value:function(t,n){if(!0!==Array.isArray(this.notificationsCollection[t])&&(this.notificationsCollection[t]=[]),this.hasSubscription(n.id))throw new u.SubscriptionAlreadyExistsException(n.id,this.getId());this.notificationsCollection[t].push(n),this.notificationsCollection[t].sort((function(t,n){return n.priority-t.priority})),this.recordSubscription(n.id,t),this.nbSubscriptionRecorded++}},{key:"getId",value:function(){return this.id}},{key:"is",value:function(t){return t===this.getId()}},{key:"destroy",value:function(){Object.values(this.notificationsCollection).forEach((function(t){i(t).forEach((function(t){t.unsubscribe()}))}))}}])&&o(n.prototype,e),r&&o(n,r),t}();n.default=c}},n={};function e(i){var r=n[i];if(void 0!==r)return r.exports;var o=n[i]={exports:{}};return t[i](o,o.exports,e),o.exports}var i={};return function(){var t=i;Object.defineProperty(t,"t",{value:!0}),t.SubscriptionNotFoundException=t.SubscriptionAlreadyExistsException=t.InvalidArgumentException=t.SubscriberHelper=t.PublisherSubscriber=t.Subscriber=t.Publisher=void 0;var n=e(829);Object.defineProperty(t,"Publisher",{enumerable:!0,get:function(){return n.default}});var r=e(757);Object.defineProperty(t,"Subscriber",{enumerable:!0,get:function(){return r.default}});var o=e(986);Object.defineProperty(t,"PublisherSubscriber",{enumerable:!0,get:function(){return o.default}}),t.SubscriberHelper=e(322);var u=e(524);Object.defineProperty(t,"InvalidArgumentException",{enumerable:!0,get:function(){return u.InvalidArgumentException}}),Object.defineProperty(t,"SubscriptionAlreadyExistsException",{enumerable:!0,get:function(){return u.SubscriptionAlreadyExistsException}}),Object.defineProperty(t,"SubscriptionNotFoundException",{enumerable:!0,get:function(){return u.SubscriptionNotFoundException}})}(),i}()}},n={};function e(i){var r=n[i];if(void 0!==r)return r.exports;var o=n[i]={exports:{}};return t[i].call(o.exports,o,o.exports,e),o.exports}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var i={};return(()=>{"use strict";var t=i;Object.defineProperty(t,"i",{value:!0}),t.TimelineSubscriber=t.TimelinePublisher=t.PubSubManager=void 0;const n=e(605),r="__qphi_pubsub_manager";class o{constructor(){this.publishers=new Map,this.subscribers=new Map,this.proxy=new n.Subscriber(r),this.history=[],this.dedicatedHistory=new Map}recordPublisher(t){this.publishers.set(t.getId(),t),this.proxy.subscribe(t,"publish",(t=>this.beforePublish(t))),this.proxy.subscribe(t,"destroy",(()=>this.removePublisher(t.getId())));const n=new Error("trace");this.updateHistory(t.getId(),{index:this.history.length,kind:"publisher recorded",message:`Publisher "${t.getId()}" added to manager.`,payload:{getTrace:()=>console.error(n),publisher_id:t.getId()}})}updateDedicatedHistoryEntry(t,n){if(this.dedicatedHistory.has(t)){let e=this.dedicatedHistory.get(t);e.push(n),this.dedicatedHistory.set(t,e)}else this.dedicatedHistory.set(t,[n])}removePublisher(t){this.publishers.delete(t);const n={index:this.history.length,kind:"publisher removed",message:`Publisher "${t}" removed from manager.`,payload:{publisher_id:t}};this.history.push(n),this.updateDedicatedHistoryEntry(t,n)}removeSubscriber(t){this.subscribers.delete(t);const n=new Error("trace");this.updateHistory(t,{index:this.history.length,kind:"subscriber removed",message:`Subscriber "${t}" removed from manager.`,payload:{getTrace:()=>console.error(n),subscriber_id:t}})}beforePublish({publisher:t,notification:n,payload:e,getTrace:i}){console.log("before publish",n,e),"destroy"!==n&&this.updateHistory(t.getId(),{index:this.history.length,kind:"publication",message:`"${t.getId()}" publish "${n}".`,payload:{publisher_id:t.getId(),getTrace:i,notification:n,payload:e}})}onSubscribe({subscription:t,notification:n}){const e=t.handler;t.handler=i=>{const r=new Error("trace");this.updateHistory(t.subscriber_id,{index:this.history.length,kind:"notification received by subscriber",message:`"${t.subscriber_id}" receives notification "${n}" from "${t.publisher_id}".`,payload:{publisher_id:t.subscriber_id,subscriber_id:t.subscriber_id,subscription_id:t.id,getTrace:()=>console.error(r),notification:n,payload:i}});try{e(i)}catch(e){console.error(e);const r=new Error("trace");throw this.updateHistory(t.subscriber_id,{index:this.history.length,kind:"error from subscriber",message:`Subscriber "${t.subscriber_id}" failed to process "${n}" notification published by "${t.publisher_id}".`,payload:{publisher_id:t.subscriber_id,subscriber_id:t.subscriber_id,subscription_id:t.id,getTrace:()=>console.error(r),notification:n,error:e,payload:i}}),e}}}updateHistory(t,n){n.at=new Date,this.history.push(n),this.updateDedicatedHistoryEntry(t,n)}recordSubscribers(t){this.subscribers.set(t.getId(),t);const n=new Error("trace");this.updateHistory(t.getId(),{index:this.history.length,kind:"subscriber recorded",message:`Subscriber "${t.getId()}" added to manager.`,payload:{subscriber_id:t.getId(),getTrace:()=>console.error(n)}}),this.proxy.subscribe(t.getProxy(),"subscribe",(t=>this.onSubscribe(t))),this.proxy.subscribe(t.getProxy(),"destroy",(()=>this.removeSubscriber(t.getId())))}getHistory(){return[...this.history]}getHistoryFor(t){return this.dedicatedHistory.has(t)?[...this.dedicatedHistory.get(t)]:[]}}t.PubSubManager=o;const u=new o;"undefined"!=typeof window?window[r]=u:e.g[r]=u;class c extends n.Publisher{constructor(t){super(t),u.recordPublisher(this)}publish(t,n){const e=new Error("trace");super.publish("publish",{publisher:this,getTrace:()=>console.error(e),notification:t,payload:n}),super.publish(t,n)}destroy(){this.publish("destroy"),super.destroy()}}t.TimelinePublisher=c;class s extends n.Subscriber{constructor(t){super(t),this.proxy=new n.Publisher(`${t}-publisher-proxy`),u.recordSubscribers(this)}getProxy(){return this.proxy}recordSubscription(t,n){super.recordSubscription(t,n),console.log("record subscription"),this.proxy.publish("subscribe",{subscription:this.findSubscriptionById(t),notification:n})}destroy(){this.proxy.publish("destroy"),this.proxy.destroy(),super.destroy()}}t.TimelineSubscriber=s;const f=new c("A"),a=new s("B");a.subscribe(f,"say_hello",(()=>{throw console.log("hello world"),new Error("Badaboum !")})),f.publish("say_hello",{toto:"lalala"}),f.publish("foo"),f.publish("bar"),a.destroy(),f.publish("say_hello"),f.destroy(),console.log(u.getHistory()),console.log(u.getHistoryFor(f.getId()))})(),i})()));